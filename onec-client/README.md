## onec-client (sandbox)

Цель: поднять **толстый клиент 1С + Конфигуратор** внутри Docker и работать через **noVNC** в браузере.
Сервер 1С должен быть доступен из контейнера (в целевой схеме — на IP Linux VM в Hyper-V).

### Что делает сборка

- Скачивает дистрибутив платформы 1С с сайта релизов по логину/паролю (BuildKit secrets).
- Ставит компоненты `server,client_full,ru` (server нужен только ради `ibcmd/ibsrv` для авто-активации).

### Что делает запуск

- Поднимает виртуальный дисплей + XFCE + VNC + noVNC.
- Если community-лицензии нет или она скоро истечёт — делает авто-активацию через `ActivateCommunity.epf`.

### Подготовка

1) Скопируй пример окружения:

- `.env.example` → `.env`

2) Заполни в `.env` (только НЕ-секреты):

- опционально `VNC_PASSWORD`
- `HOST_1C_SERVER` — адрес сервера 1С (для Hyper-V VM: IP в локалке, например `192.168.0.50`)

3) Подготовь secrets (НЕ храним в `.env`):

- файлы в `../secrets/`:
  - `onec_username`, `onec_password` — нужны только если в `.devcontainer/distr` нет локального `.run` и требуется скачивание с `releases.1c.ru`
  - `dev_login`, `dev_password` — нужны для community-активации

Сгенерировать файлы можно скриптом:

```bash
../scripts/prepare-secrets.sh
```

### Сборка и запуск

```bash
docker compose up --build
```

Открой в браузере:

- `http://localhost:6080/vnc.html`

### Как подключаться к серверу на хосте

Если сервер 1С развёрнут в Hyper-V VM, укажи его LAN IP через `HOST_1C_SERVER` в `.env`.

Дальше в 1С (внутри VNC) добавляешь информационную базу на сервере как обычно и открываешь **Конфигуратор**.

### Где лежат лицензии

- Лицензии монтируются в volume: `/var/1C/licenses`

Если нужно сбросить лицензии — можно удалить volume `onec-client-onec-client-licenses` (или руками очистить каталог в контейнере).

